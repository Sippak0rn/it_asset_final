{% extends "base_auth.html" %}
{% set title = "Login / Register" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth_double.css') }}">
{% endblock %}

{% block content %}
<div class="auth-wrap">
  <div class="auth-shell {% if mode == 'register' %}is-register{% endif %}" id="authShell">

    <div class="auth-panels">

      <!-- ================= LOGIN ================= -->
      <div class="auth-side">
        <div class="auth-card">

          <h1 class="auth-title">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h1>
          <div class="auth-sub">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ üëã</div>

          <form method="post" action="{{ url_for('auth.login') }}">
            {{ login_form.csrf_token }}

            <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
            {{ login_form.email(
              class="form-control",
              placeholder="name@example.com",
              autocomplete="username"
            ) }}
            <div class="form-hint">‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏ß‡πâ</div>

            <label class="mt-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            {{ login_form.password(
              class="form-control",
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",
              autocomplete="current-password"
            ) }}
            <div class="form-hint">‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</div>

            <button class="btn btn-primary w-100 mt-3" type="submit">
              ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
            </button>

            <div class="auth-actions">
              <a class="auth-link" href="{{ url_for('auth.forgot_password') }}">
                ‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô?
              </a>

              <a href="#" class="auth-link" id="goRegister1">
                ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
              </a>
            </div>
          </form>

        </div>
      </div>

      <!-- ================= REGISTER ================= -->
      <div class="auth-side">
        <div class="auth-card">

          <h1 class="auth-title">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h1>
          <div class="auth-sub">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>

          <form method="post" action="{{ url_for('auth.register') }}">
            {{ register_form.csrf_token }}

            <label>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
            {{ register_form.full_name(
              class="form-control",
              placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ",
              autocomplete="name"
            ) }}
            <div class="form-hint">‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>

            <label class="mt-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
            {{ register_form.email(
              class="form-control",
              placeholder="name@example.com",
              autocomplete="username"
            ) }}
            <div class="form-hint">‡πÉ‡∏ä‡πâ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>

            <label class="mt-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            {{ register_form.password(
              class="form-control",
              placeholder="‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 4 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£",
              autocomplete="new-password"
            ) }}
            <div class="form-hint">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏™‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</div>

            <label class="mt-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
            {{ register_form.confirm(
              class="form-control",
              placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
              autocomplete="new-password"
            ) }}
            <div class="form-hint">‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</div>

            <button class="btn btn-primary w-100 mt-3" type="submit">
              ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
            </button>

            <div class="auth-actions">
              <span class="text-secondary small">
                ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß?
              </span>
              <button
                class="btn btn-sm btn-outline-light"
                type="button"
                id="goLogin1">
                ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
              </button>
            </div>

          </form>
        </div>
      </div>

    </div>

    <!-- ================= OVERLAY ================= -->
    <div class="auth-overlay">
      <div class="auth-overlay-inner">
        <div class="auth-overlay-panel only-center">

          <img
            src="{{ url_for('static', filename='img/college_logo.png') }}"
            class="auth-overlay-logo"
            alt="logo">

          <h2 class="auth-overlay-title">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h2>

          <p class="auth-overlay-text">
            ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö<br>
            ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå ‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°
          </p>

        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
(() => {
  const shell = document.getElementById("authShell");

  document.getElementById("goRegister1")?.addEventListener("click", e => {
    e.preventDefault();
    shell.classList.add("is-register");
  });

  document.getElementById("goLogin1")?.addEventListener("click", () => {
    shell.classList.remove("is-register");
  });
})();
</script>
<!-- ‚úÖ ADD: loading on submit (‡πÑ‡∏°‡πà‡πÅ‡∏ï‡∏∞‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°) -->
<script>
document.querySelectorAll("form").forEach(form => {
  form.addEventListener("submit", e => {
    const btn = form.querySelector("button[type=submit]");
    if (!btn) return;

    btn.classList.add("btn-loading");
    btn.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...";
  });
});
</script>
<script>
document.querySelectorAll("form").forEach(form => {
  form.addEventListener("submit", e => {
    const btn = form.querySelector("button[type=submit]");
    if (!btn || btn.classList.contains("btn-loading")) return;

    e.preventDefault(); // ‚õî ‡∏´‡∏¢‡∏∏‡∏î submit ‡∏Å‡πà‡∏≠‡∏ô

    btn.classList.add("btn-loading");
    const oldText = btn.innerHTML;
    btn.innerHTML = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...";

    // ‚è≥ ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ notification ‡πÑ‡∏î‡πâ‡πÇ‡∏ä‡∏ß‡πå
    setTimeout(() => {
      btn.innerHTML = oldText;
      form.submit(); // ‚úÖ ‡∏Ñ‡πà‡∏≠‡∏¢ submit ‡∏à‡∏£‡∏¥‡∏á
    }, 1500); // ‚Üê ‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ: 1200 / 1500 / 1800
  });
});
</script>

{% endblock %}
